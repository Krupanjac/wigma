<div class="flex flex-col h-full bg-zinc-900">
  <!-- Header -->
  <div class="flex items-center px-3 py-2 border-b border-zinc-800">
    <span class="text-xs font-semibold text-zinc-400 uppercase tracking-wider">Properties</span>
  </div>

  <div class="border-b border-zinc-800 px-3 py-2">
    <div class="flex items-center justify-between">
      <span class="text-[10px] font-semibold uppercase tracking-wider text-zinc-500">File</span>
      <span class="text-[10px] text-zinc-500">{{ project.isDirty() ? 'Unsaved' : 'Saved' }}</span>
    </div>
    <div class="mt-2 space-y-2">
      <input
        type="text"
        [value]="project.document().name"
        (change)="setProjectName($any($event.target).value)"
        placeholder="Project name"
        class="h-7 w-full rounded border border-zinc-700 bg-zinc-800 px-2 text-[11px] text-zinc-100 outline-none focus:border-blue-500"
      />
      <textarea
        rows="2"
        [value]="project.document().description"
        (change)="setProjectDescription($any($event.target).value)"
        placeholder="Project details"
        class="w-full rounded border border-zinc-700 bg-zinc-800 px-2 py-1 text-[11px] text-zinc-100 outline-none focus:border-blue-500 resize-none"
      ></textarea>
    </div>
    <div class="mt-2 grid grid-cols-2 gap-2">
      <button
        type="button"
        class="h-7 rounded border border-zinc-700 bg-zinc-800 px-2 text-[11px] text-zinc-200 hover:bg-zinc-700"
        (click)="createNewProject()">
        New Project
      </button>
      <button
        type="button"
        class="h-7 rounded border border-zinc-700 bg-zinc-800 px-2 text-[11px] text-zinc-200 hover:bg-zinc-700"
        (click)="saveProject()">
        Save
      </button>
      <label
        class="h-7 cursor-pointer rounded border border-zinc-700 bg-zinc-800 px-2 text-[11px] text-zinc-200 hover:bg-zinc-700 inline-flex items-center justify-center">
        Import JSON
        <input type="file" accept="application/json,.json" class="hidden" (change)="onImportProjectChange($event)" />
      </label>
      <button
        type="button"
        class="h-7 rounded border border-zinc-700 bg-zinc-800 px-2 text-[11px] text-zinc-200 hover:bg-zinc-700"
        (click)="exportProjectJson()">
        Export JSON
      </button>
      <button
        type="button"
        class="h-7 rounded border border-zinc-700 bg-zinc-800 px-2 text-[11px] text-zinc-200 hover:bg-zinc-700"
        (click)="exportPng()">
        Export PNG
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-y-auto">
    @if (selectedCount() === 0) {
      <div class="p-4 text-xs text-zinc-500 text-center">Select a layer to view properties</div>
    } @else {
      @if (selectedCount() === 1) {
        <div class="px-3 py-3 border-b border-zinc-800">
          <div class="flex items-center gap-2">
            <input
              type="text"
              [value]="selectedNode().name"
              (change)="setName($any($event.target).value)"
              class="bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-[11px] text-white flex-1 min-w-0 focus:border-blue-500 outline-none h-8"
            />
            <span class="text-[10px] text-zinc-500 uppercase tracking-wider">{{ selectedNode().type }}</span>
          </div>

          <div class="mt-2 flex items-center gap-2">
            <button
              class="px-2 py-1 text-[11px] rounded border border-zinc-700 bg-zinc-800 hover:bg-zinc-700 h-7"
              (click)="toggleVisible()"
              [class.text-zinc-200]="selectedNode().visible"
              [class.text-zinc-500]="!selectedNode().visible"
              title="Toggle visibility"
            >
              {{ selectedNode().visible ? 'Visible' : 'Hidden' }}
            </button>

            <button
              class="px-2 py-1 text-[11px] rounded border border-zinc-700 bg-zinc-800 hover:bg-zinc-700 h-7"
              (click)="toggleLocked()"
              [class.text-zinc-200]="selectedNode().locked"
              [class.text-zinc-500]="!selectedNode().locked"
              title="Toggle lock"
            >
              {{ selectedNode().locked ? 'Locked' : 'Unlocked' }}
            </button>

            <div class="ml-auto flex items-center gap-1">
              <span class="text-[10px] text-zinc-500">Opacity</span>

              <div class="flex items-center">
                <input
                  type="number"
                  min="0"
                  max="100"
                  [value]="Math.round(selectedNode().opacity * 100)"
                  (change)="setOpacityPercent($any($event.target).value)"
                  class="bg-zinc-800 border border-zinc-700 rounded-l-lg px-2 py-1 text-[11px] text-white w-14 h-7 focus:border-blue-500 outline-none text-center"
                />
                <div class="flex flex-col">
                  <button
                    type="button"
                    class="w-6 h-[14px] flex items-center justify-center bg-zinc-800 border border-zinc-700 border-l-0 rounded-tr-lg hover:bg-zinc-700 active:bg-zinc-600 text-zinc-200 leading-none"
                    (click)="nudgeOpacity(1, $event)"
                    title="Increase (Shift = x10)"
                    aria-label="Increase opacity"
                  >
                    ▲
                  </button>
                  <button
                    type="button"
                    class="w-6 h-[14px] flex items-center justify-center bg-zinc-800 border border-zinc-700 border-l-0 border-t-0 rounded-br-lg hover:bg-zinc-700 active:bg-zinc-600 text-zinc-200 leading-none"
                    (click)="nudgeOpacity(-1, $event)"
                    title="Decrease (Shift = x10)"
                    aria-label="Decrease opacity"
                  >
                    ▼
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      }

      <app-transform-section [engine]="engine" [node]="selectedNode()" [refreshTick]="refreshTick()" />
      <app-fill-section [engine]="engine" [node]="selectedNode()" />
      <app-stroke-section [engine]="engine" [node]="selectedNode()" />
      @if (hasText()) {
        <app-text-section [engine]="engine" [node]="selectedNode()" />
      }
    }
  </div>
</div>
